{% extends "base.html" %}
{% load static %} 

{% block mycontent %}
<section class= "mytitle bg-dark text-white py-4 my-1" >
  <div class ="container">
    <header class== "bg-dark py-2">
      <div class = "container px-4 px-lg-5 my-2">
        <div class='text-center text-white'>
          <h1 class = "display-4 fw-border"> THÔNG TIN THANH TOÁN
            <p class="lead fw-normal text-white-50 mb-0"> 
              Nhập thông tin thanh toán của Quý Khách
            </p>
          </h1>
        </div>
      </div>
    </header>
  </div>
</section>

<!-- FORM KIỂM TRA THÔNG TIN ĐƠN HÀNG-->
<div class="container">
  <div class = "col-md-8 offset-md-2">
    <div class="card">
      <div class="card-header">
        <strong>ĐƠN HÀNG CỦA BẠN</strong>
      </div>
      <div class="card-body">
        {% for sp in cart_san_pham %}
          <strong>{{ forloop.counter }}. </strong>{{sp.ten_san_pham}}
          {% if sp.ton_kho %}
            <br>
              <small> Số lượng: 
              {% for key, val in so_luong.items%} 
              {% comment %} Giải sử key ="Sản phẩm mới nhất". thì slugify trả về : "san-pham-moi-nhat" {% endcomment %}
                {% if key == sp.id|slugify %}
                  {{val}}
                  {% comment %} <option value="1">{{val}}</option> {% endcomment %}
                {% endif %}
              {% endfor%}</small> 
            </br>
            
          {% else %}
            (Đã hết hàng) 
            </br>
          {% endif %}
          
        {% endfor%}
        <br>
          <strong >* Tổng giá trị: {{tong_gia_tri}} (đồng)</strong>
        </br>
        <br>
          <a href = '{% url "cart_sumary" %}' class ='btn btn-sm btn-outline-success'>Chỉnh sửa giỏ hàng</a> 
        </br>
        </div>
    </div>

    <!--  FORM KIỂM TRA THÔNG TIN GIAO HÀNG -->
    <br></br>
    <div class="card">
      <div class="card-header">
        <strong>THÔNG TIN GIAO NHẬN HÀNG HÓA</strong>
      </div>
      <div class="card-body">
        <form method='POST' action="{% url 'billing_info' %}" >
          {%csrf_token%}
           
          <strong>Người nhận: {{ shipping_info.shipping_full_name}}</strong>
            
          <li>Địa chỉ nhận: {{ shipping_info.shipping_address}} </li>         
          {% if shipping_info.shipping_phone%}
          <li>Số điện thoại: {{ shipping_info.shipping_phone}}</li>
          {% endif %}
         

        </form>
        <a href = '{% url "check_out" %}' class ='btn btn-sm btn-outline-success'>Chỉnh sửa giao hàng</a>
      </div>
    </div></form>
    

    <!--  FORM KIỂM TRA THÔNG TIN THANH TOÁN -->
    <br></br>
    <div class="card">
      <div class="card-header">
        <strong>NHẬP THÔNG TIN CHUYỂN KHOẢN</strong>
        <p>(Dành cho khách hàng thanh toán chuyển khoản)</p>
      </div>
      <div class="card-body">
        <form method='POST' action="{% url 'process_order' %}">
          {% csrf_token %}
          {{billing_form.as_p}}

        
        {% comment %} <a href = '{% url "check_out" %}' class ='btn btn-sm btn-outline-success'>Chỉnh sửa thông tin thanh toán</a> {% endcomment %}
      </div>
    </div>
    <br></br>
    <button type='submit'class ='btn btn btn-outline-danger'>
      Đặt hàng ngay

    </button>
    </form>
    <br></br>

  </div>
</div>


<!-- css cho Phần slider san_phams -->
<style>
  .item {
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
  }
  

  .click-item{
    text-decoration: none;
    color: black; /* Màu chữ mặc định */
    
  }

  .h5 {
    color: black;
  }
  h6 {
    text-align: center;
  }

  .item:hover h5 {
    color: #ffc107; /* Màu chữ khi di chuột qua */
  }

  /* General button style */
  .btn.btn-sm.btn-outline-success {
    background-color: #007bff; /* Blue background color */
    color: white; /* White text color */
    border: 1px solid #007bff; /* Blue border */
    transition: background-color 0.3s ease; /* Smooth transition effect */
  }

  /* Hover effect for red background */
  .btn.btn-sm.btn-outline-success:hover {
    background-color: #dc3545; /* Red background color on hover */
  }

</style>
<script>
  // Check if button pressed
  $(document).on('click', '#add_cart', function(e){
    e.preventDefault();  // Prevent default form submission

    $.ajax({
      type: "POST",
      url: '{% url "cart_add" %}',
      data: {
        //san_pham_id: $(this).val(),  // Use `$(this).val()` to get button value
        san_pham_id: $('#add_cart').val(),
        so_luong: $('#qty_of_buyer option:selected').text(),
        csrfmiddlewaretoken:'{{ csrf_token }}',
        action: 'post'
      },
      success: function(json){
        //console.log(json)
        
        //Dòng sau bị sai trước khi đi Đồng Tháp--> Đã thành công
        //.cart_quantity

        document.getElementById('cart_quantity').textContent= json.so_luong_gio
        //location.reload();
        
      },
      error: function(xhr, errmsg, err){}
    });
  });
</script>



{% endblock mycontent %} 


<!--
  https://kimphathiepthanh.com/danh-muc-san-pham/trang-suc-cau-hon/page/2/
-->
